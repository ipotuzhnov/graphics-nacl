<!DOCTYPE html>
<html>
<!--
Copyright (c) 2012 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->
<head>
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="-1">
  <title>Graphics</title>
  <script type="text/javascript">
    var plugin = null;
    var height = 300;
    
    function didLoad() {
      if (plugin == null)
        return;
      plugin = document.getElementById('plugin');
      plugin.addEventListener("message",
                              //function(message) { alert(message.data); },
                              downloadCallback,
                              false);
    }

    function loadPlugin() {
      plugin = document.getElementById('plugin');
      if (plugin) {
        plugin.addEventListener("message",
                              //function(message) { alert(message.data); },
                              downloadCallback,
                              false);
        alert("plugin loaded");
      }
    }
    
    function sayHello() {
      if (plugin == null)
        return;
      plugin.postMessage("Hello from Browser");
    }
    
    function changeSize() {
      if (plugin == null)
        return;
      height++;
      plugin.style.height = height + "px"
    }
    
    function downloadUrl() {
      if (plugin == null)
        return;
      plugin.postMessage("download:Start");
    }
    
    function downloadCallback(message) {
      if (plugin == null)
        alert("no plugin");
      if (message.data == "download:Ok") {
        plugin.postMessage("download:Ok");
        //alert(message.data);
      } else if (message.data == "download:Error") {
        plugin.postMessage("download:Error");
        alert(message.data);
      } else if (message.data == "djvu:Ok") {
        plugin.postMessage("djvu:Ok");
        //alert(message.data);
      } else if (message.data == "djvu:Error") {
        plugin.postMessage("download:Error");
        alert(message.data);
      } else {
        alert("strange message: " + message.data);
      }
    }
  </script>
</head>
<body onload="didLoad()">
  <h1>Graphics</h1>
  <div id="listener">
    <embed id="plugin"
           width=200 height=300
           src="graphics_nacl.nmf"
           docsrc="1.djvu"
           type="application/x-pnacl" />
  </div>
  <button onclick="loadPlugin();">load</button>
  <button onclick="sayHello();">Say Hello!</button>
  <!--button onclick="changeSize();">changeSize!</button-->
  <button onclick="downloadUrl();">download</button>
</body>
</html>
